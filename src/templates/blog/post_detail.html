{% extends 'blog/base.html' %}

{% load static %}

{% block title %} Internet_blog - {{ post.header }} {% endblock title %}

{% block content %}
<div class="post-wrap">
    <div class="post-cover" style="background-image: url({{ post.categories.all.0.cover.url }});">
        <span class="post-header">{{ post.header }}</span>
    </div>
    <div class="post-content-wrap">
        <div class="post-content">
            <div class="post-categories">
                {% for category in post.categories.all %}
                    <span class="post-category">
                        {{ category }}
                    </span>
                {% endfor %}
            </div>
            <div class="post-tags">
                <img src="{% static 'image/tags.png'%}"  class="label">
                {% for tag in post.tags.all %}
                    <div class="tag-block">
                        {{ tag }}
                    </div>
                {% endfor %}
            </div>
            <img src="{{ post.cover.url }}" class="post-content-cover">
            {{ post.content|safe }}

            <div class="post-labels">
                <form action="{% url 'blog:post_reaction' post.id %}" method="post" id="form-reaction">
                    {% csrf_token %}
                    <input type="hidden" name="like" value="" id="reaction-value">
                    <button type="submit">
                        <img src="{% static 'image/like.png'%}" class="label">
                        {{ post.like_count }}
                    </button>
                    <button type="submit">
                        <img src="{% static 'image/dislike.png'%}"  class="label">
                        {{ post.dislike_count }}
                    </button>
                </form>
                <img src="{% static 'image/comment.png'%}"  class="label">
                {{ post.comment_count }}
            </div>

        </div>
        <div class="post-author-wrap">
            <div class="post-author">
                <div class="author-header">
                    <img src="{% static 'image/telegram.png' %}" class="author-icon">
                    <span>{{ post.author.username }}</span>
                </div>
                <div class="author-describe">
                    text
                </div>
                <div class="author-categories">
                    <div class="post-categories">
                        {% for category in post.categories.all %}
                            <span class="post-category">
                                {{ category }}
                            </span>
                        {% endfor %}
                    </div>
                </div>
                <div class="author-tags">
                    <div class="post-tags">
                        {% for tag in post.tags.all %}
                            <div class="tag-block">
                                {{ tag }}
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="author-stat">
                    <img src="{% static 'image/like.png' %}" class="label"> 100
                    <img src="{% static 'image/dislike.png' %}" class="label"> 100
                    <img src="{% static 'image/comment.png' %}" class="label"> 100
                </div>
            </div>
            <div class="post-author-popular-posts">
                <span class="header">Most popular</span>
                <a href="#" class="content-block">
                    <span class="post-header">Header</span>
                    <span class="post-describe">text </span>
                </a>
            </div>
        </div>
    </div>
</div>
<script>

    form = document.getElementById('form-reaction');
    form_input = document.getElementById('reaction-value');
    form_buttons = form.querySelectorAll('button');

    form_buttons[0].addEventListener('click', e => {
        form_input.value = 1;
    });
    
    form_buttons[1].addEventListener('click', e => {
        form_input.value = 0;
    });

    form.addEventListener('submit', e => {
        e.preventDefault();
        url = e.target.action

        const formData = new FormData();
        formData.append('like', form_input.value);
        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

        fetch(url, {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(result => {
            form_buttons[0].lastChild.textContent = result['likes'];
            form_buttons[1].lastChild.textContent = result['dislikes'];
        });
    })
</script>
{% endblock content %}